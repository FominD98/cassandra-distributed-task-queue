<?xml version="1.0" encoding="utf-8" ?>

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="..\Common.vars" Condition="$(CommonVarsImported) == ''" />

  <PropertyGroup>
    <ProjectDir>$(CatalogueRootDirectory)\RemoteTaskQueue\ExchangeService</ProjectDir>
    <ProjectFile>$(ProjectDir)\ExchangeService.csproj</ProjectFile>
    <OutputDirName>ExchangeService</OutputDirName>
  </PropertyGroup>

  <Import Project="..\..\..\..\MSBuild\DeployTargets\Targets\Service.targets" />

  <Target Name="RunLocal">
    <AsyncRunInCommandLine Path='"$(ProjectDir)\$(OutputPath)\$(AssemblyName).exe"' />
    <MSBuild.Community.Tasks.Sleep Milliseconds="1000" />
    <AsyncRunInCommandLine Path='"$(ProjectDir)\$(OutputPath)\$(AssemblyName).exe"' />
    <MSBuild.Community.Tasks.Sleep Milliseconds="1000" />
    <AsyncRunInCommandLine Path='"$(ProjectDir)\$(OutputPath)\$(AssemblyName).exe"' />
    <MSBuild.Community.Tasks.Sleep Milliseconds="1000" />
    <AsyncRunInCommandLine Path='"$(ProjectDir)\$(OutputPath)\$(AssemblyName).exe"' />
    <MSBuild.Community.Tasks.Sleep Milliseconds="1000" />
    <AsyncRunInCommandLine Path='"$(ProjectDir)\$(OutputPath)\$(AssemblyName).exe"' />
    <MSBuild.Community.Tasks.Sleep Milliseconds="1000" />
  </Target>

  <Target Name="Run">
    <ScheduleService
      Path="$(DeployDir)\$(OutputDirName)\$(AssemblyName).exe"
      Group="$(ServiceGroupName)-1"
      StartStrategy="Once"
      MachineName="$(TargetMachineName)"
      RunThroughHostProcess="$(RunThroughHostProcess)"
	    SleepBeforeCheckTaskAliveMilliseconds="5000" />

    <ScheduleService
      Path="$(DeployDir)\$(OutputDirName)\$(AssemblyName).exe"
      Group="$(ServiceGroupName)-2"
      StartStrategy="Once"
      MachineName="$(TargetMachineName)"
      RunThroughHostProcess="$(RunThroughHostProcess)"
	    SleepBeforeCheckTaskAliveMilliseconds="5000" />

    <ScheduleService
      Path="$(DeployDir)\$(OutputDirName)\$(AssemblyName).exe"
      Group="$(ServiceGroupName)-3"
      StartStrategy="Once"
      MachineName="$(TargetMachineName)"
      RunThroughHostProcess="$(RunThroughHostProcess)"
	    SleepBeforeCheckTaskAliveMilliseconds="5000" />

    <ScheduleService
      Path="$(DeployDir)\$(OutputDirName)\$(AssemblyName).exe"
      Group="$(ServiceGroupName)-4"
      StartStrategy="Once"
      MachineName="$(TargetMachineName)"
      RunThroughHostProcess="$(RunThroughHostProcess)"
	    SleepBeforeCheckTaskAliveMilliseconds="5000" />

    <ScheduleService
      Path="$(DeployDir)\$(OutputDirName)\$(AssemblyName).exe"
      Group="$(ServiceGroupName)-5"
      StartStrategy="Once"
      MachineName="$(TargetMachineName)"
      RunThroughHostProcess="$(RunThroughHostProcess)"
	    SleepBeforeCheckTaskAliveMilliseconds="5000" />

  </Target>


  <Target Name="Stop">
    <StopServices WaitingToStopMilliseconds="60000" Group="$(ServiceGroupName)-1" MachineName="$(TargetMachineName)" />
    <StopServices WaitingToStopMilliseconds="60000" Group="$(ServiceGroupName)-2" MachineName="$(TargetMachineName)" />
    <StopServices WaitingToStopMilliseconds="60000" Group="$(ServiceGroupName)-3" MachineName="$(TargetMachineName)" />
    <StopServices WaitingToStopMilliseconds="60000" Group="$(ServiceGroupName)-4" MachineName="$(TargetMachineName)" />
    <StopServices WaitingToStopMilliseconds="60000" Group="$(ServiceGroupName)-5" MachineName="$(TargetMachineName)" />
  </Target>


</Project>
